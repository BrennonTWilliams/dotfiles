# ===================================
# Starship ugruvbox-rainbow-light Mode Configuration
# ===================================
# Generated by build-configs.sh - DO NOT EDIT DIRECTLY
# Edit the modular components instead and rebuild

# Get editor completions based on the config schema
"$schema" = 'https://starship.rs/config-schema.json'

# ===================================
# Gruvbox-Rainbow Light Format Configuration
# ===================================
# Light variant of the gruvbox-rainbow preset
# Optimized for IosevkaTerm Nerd Font

# Command timeout
command_timeout = 2000

# Gruvbox-rainbow format string with proper background syntax
format = """
[](color_red)\
$os\
$shell\
[](bg:color_orange fg:color_red)\
$directory\
[](fg:color_orange bg:color_yellow)\
$git_branch\
$git_status\
[](fg:color_yellow bg:color_green)\
$package\
$nodejs\
$python\
$golang\
$rust\
$java\
[](fg:color_green bg:color_aqua)\
$docker_context\
$terraform\
$kubernetes\
[](fg:color_aqua bg:color_purple)\
$jobs\
[](fg:color_purple bg:color_bg1)\
$status\
[ ](fg:color_bg1)\
$character"""

# Right side prompt with duration and time
right_format = """$cmd_duration$time"""

# Use the gruvbox palette
palette = 'gruvbox_rainbow'

# Gruvbox Light color palette
[palettes.gruvbox_rainbow]
color_fg0 = '#3c3836'   # dark1 (text on colored bg)
color_bg1 = '#d5c4a1'   # light3 (muted bg)
color_bg3 = '#bdae93'   # light4
color_red = '#9d0006'
color_orange = '#af3a03'
color_yellow = '#b57614'
color_green = '#79740e'
color_aqua = '#427b58'
color_blue = '#076678'
color_purple = '#8f3f71'

# ===================================
# Core Base Modules Configuration
# ===================================
# Core modules excluding frequently overridden ones

# Character that appears after the last command prompt

# ===================================
# Programming Languages Configuration
# ===================================
# Language-specific modules used across all Starship modes

# Package manager module

# ===================================
# Container and Build Tools Configuration
# ===================================
# Container and build system modules used across all Starship modes

# Docker context module
[container]
format = "[$symbol \\[$name\\]]($style) "
symbol = "󰏨"
style = "red bold dimmed"

# Kubernetes module
[cmake]
format = "[$symbol($version )]($style)"
symbol = " "
style = "bold blue"
detect_extensions = ["cmake"]
detect_files = ["CMakeLists.txt", "CMakeCache.txt"]
detect_folders = []

# Nix shell module
[nix_shell]
format = '[$symbol$state( \($name\))]($style) '
symbol = " "
style = "bold blue"
impure_msg = "impure"
pure_msg = "pure"
unknown_msg = "unknown"

# ===================================
# Platform-Specific Modules Configuration
# ===================================
# Custom modules for platform detection and development environment

# Custom terminal detection
[custom.terminal]
command = "echo $TERM"
when = "true"
format = "[$output]($style) "
style = "bold yellow"

# macOS-specific modules (only show on macOS)
[custom.macos]
command = "uname"
when = "[[ $(uname) == 'Darwin' ]]"
format = "[$output]($style) "
style = "bold dimmed white"

# Linux-specific modules (only show on Linux)
[custom.linux]
command = "uname -o"
when = "[[ $(uname) == 'Linux' ]]"
format = "[$output]($style) "
style = "bold dimmed white"

# Sway-specific indicator (only show in Sway)
[custom.sway]
command = "echo $SWAYSOCK"
when = "[[ -n $SWAYSOCK ]]"
format = "[󰕲 Sway]($style) "
style = "bold magenta"

# Show if in a tmux session
[custom.tmux]
command = "echo $TMUX"
when = "[[ -n $TMUX ]]"
format = "[󰆍 tmux]($style) "
style = "bold blue"

# Show if running in Ghostty (macOS)
[custom.ghostty]
command = "echo $GHOSTTY_RESOURCES"
when = "[[ -n $GHOSTTY_RESOURCES ]]"
format = "[󰊠 Ghostty]($style) "
style = "bold green"

# Show if running in Foot (Linux Wayland)
[custom.foot]
command = "echo $FOOT_TERMINAL_ID"
when = "[[ -n $FOOT_TERMINAL_ID ]]"
format = "[󰆍 Foot]($style) "
style = "bold green"

# Show current git commit hash
[custom.git_commit]
command = "git rev-parse --short HEAD 2>/dev/null"
when = "git rev-parse --git-dir > /dev/null 2>&1"
format = "[($output)]($style) "
style = "bold dimmed white"

# Show AWS profile if active
[custom.aws_profile]
command = "echo $AWS_PROFILE"
when = "[[ -n $AWS_PROFILE ]]"
format = "[󰌾 AWS: $output]($style) "
style = "bold yellow"

# ===================================
# System Information Modules Configuration
# ===================================
# System monitoring and status modules

# Battery indicator (for laptops)
[battery]
format = "[$symbol$percentage]($style) "
full_symbol = "󰁹"
charging_symbol = "󰂄"
discharging_symbol = "󰂃"
unknown_symbol = "󰁼"
empty_symbol = "󰚥"
disabled = false

[[battery.display]]
threshold = 10
style = "bold red"

[[battery.display]]
threshold = 30
style = "bold yellow"

[[battery.display]]
threshold = 60
style = "bold green"

# Time module
[custom.memory]
command = """
case $(uname) in
  Darwin)
    # macOS
    vm_stat | perl -ne '/page size of (\\d+)/ and $ps=$1; /Pages free:\\s+(\\d+)/ and $pf=$1; /Pages active:\\s+(\\d+)/ and $pa=$1; /Pages inactive:\\s+(\\d+)/ and $pi=$1; /Pages wired down:\\s+(\\d+)/ and $pw=$1; END { printf \"%.1fGB\", ($pf+$pa+$pi+$pw)*$ps/1024/1024/1024; }'
    ;;
  Linux)
    # Linux
    free -h | awk '/^Mem:/ {print $3}'
    ;;
esac
"""
format = "[󰍛 $output]($style) "
style = "bold dimmed blue"
when = "true"

# ===================================
# Base Modules Configuration
# ===================================
# Fundamental modules that don't fit into other categories

# Command status module
[localip]
ssh_only = false
format = "[$localipv4]($style) "
style = "bold dimmed purple"
disabled = true

# ===================================
# GitHub Integration Modules Configuration
# ===================================
# Custom modules for GitHub integration and user information

# GitHub username module - displays first name from GitHub or git config
[custom.github_username]
command = """
#!/bin/bash
# Setup cache directory
CACHE_DIR="${XDG_CACHE_HOME:-$HOME/.cache}/starship-github"
mkdir -p "$CACHE_DIR" 2>/dev/null || CACHE_DIR="/tmp/starship-github-$USER"
mkdir -p "$CACHE_DIR" 2>/dev/null

CACHE_FILE="$CACHE_DIR/github_user_name.cache"
CACHE_TTL=3600  # 1 hour in seconds

# Function to check if cache is fresh
is_cache_fresh() {
    [[ -f "$1" ]] && [[ $(($(date +%s) - $(stat -c %Y "$1" 2>/dev/null || stat -f %m "$1" 2>/dev/null))) -lt $CACHE_TTL ]]
}

# Try GitHub CLI first with caching
if command -v gh &> /dev/null && gh auth status &> /dev/null; then
    # Check cache first
    if is_cache_fresh "$CACHE_FILE"; then
        cached_name=$(cat "$CACHE_FILE" 2>/dev/null)
        if [[ -n "$cached_name" && "$cached_name" != "null" ]]; then
            echo "$cached_name"
            exit 0
        fi
    fi

    # Cache miss or expired - fetch from API
    github_name=$(gh api user --jq .name 2>/dev/null)
    if [[ -n "$github_name" && "$github_name" != "null" ]]; then
        first_name=$(echo "$github_name" | cut -d' ' -f1)
        echo "$first_name" > "$CACHE_FILE" 2>/dev/null
        echo "$first_name"
        exit 0
    fi
fi

# Fallback to git config
git_name=$(git config user.name 2>/dev/null)
if [[ -n "$git_name" ]]; then
    echo "$git_name" | cut -d' ' -f1
    exit 0
fi

# Final fallback to system username
echo "$USER"
"""
when = "true"
format = "[$output]($style)"
style = "bold blue"
show_always = false
description = "Displays GitHub first name or git config first name (cached for 1 hour)"

# GitHub repository status indicator (enhanced)
[custom.github_status]
command = """
#!/bin/bash
if command -v gh &> /dev/null && git rev-parse --git-dir &> /dev/null; then
    # Setup cache directory
    CACHE_DIR="${XDG_CACHE_HOME:-$HOME/.cache}/starship-github"
    mkdir -p "$CACHE_DIR" 2>/dev/null || CACHE_DIR="/tmp/starship-github-$USER"
    mkdir -p "$CACHE_DIR" 2>/dev/null

    # Get current repo path as cache key
    REPO_PATH=$(git rev-parse --show-toplevel 2>/dev/null | sed 's/[^a-zA-Z0-9]/_/g')
    CACHE_FILE="$CACHE_DIR/github_repo_${REPO_PATH}.cache"
    CACHE_TTL=3600  # 1 hour in seconds

    # Function to check if cache is fresh
    is_cache_fresh() {
        [[ -f "$1" ]] && [[ $(($(date +%s) - $(stat -c %Y "$1" 2>/dev/null || stat -f %m "$1" 2>/dev/null))) -lt $CACHE_TTL ]]
    }

    # Check cache first
    if is_cache_fresh "$CACHE_FILE"; then
        cached_info=$(cat "$CACHE_FILE" 2>/dev/null)
        if [[ -n "$cached_info" ]]; then
            echo "$cached_info"
            exit 0
        fi
    fi

    # Cache miss or expired - fetch from API (single combined call)
    repo_info=$(gh repo view --json nameWithOwner,visibility,isFork --jq '.nameWithOwner + " " + .visibility + " " + (if .isFork then "fork" else "origin" end)' 2>/dev/null)
    if [[ -n "$repo_info" ]]; then
        echo "$repo_info" > "$CACHE_FILE" 2>/dev/null
        echo "$repo_info"
    fi
fi
"""
when = "true"
format = "[󰊬 $output]($style) "
style = "dimmed white"
description = "Shows GitHub repository information when in a GitHub repo (cached for 1 hour)"

# ===================================
# Core Overridable Modules Configuration
# ===================================
# Core modules that are frequently overridden in different modes

# System username (disabled - using GitHub username instead)
[username]
disabled = true

# GitHub username module replaces the standard username
# This is defined in github-modules.toml and will be included by the build system

[hostname]
format = "[$hostname]($style) in "
style = "bold dimmed green"
ssh_only = false
detect_env_vars = ["SSH_CONNECTION", "SSH_CLIENT", "SSH_TTY"]
trim_at = "."

# Shell level indicator
[shlvl]
disabled = false
format = "[$symbol]($style) "
symbol = "󰔟 "
threshold = 2
repeat = true
style = "bold yellow"

# Directory module

# ===================================
# Gruvbox-Rainbow Light Mode Overrides
# ===================================
# Light variant of gruvbox-rainbow preset customizations
# Optimized for IosevkaTerm Nerd Font
#
# Color scheme (rainbow gradient):
# - color_red:    OS, Shell
# - color_orange: Directory
# - color_yellow: Git Branch, Git Status
# - color_green:  Package, Languages
# - color_aqua:   Containers
# - color_purple: Jobs
# - color_bg1:    Status

# Character configuration
[character]
success_symbol = "[❯](color_green)"
error_symbol = "[❯](color_red)"
vimcmd_symbol = "[❮](color_green)"
vimcmd_replace_one_symbol = "[❮](color_purple)"
vimcmd_replace_symbol = "[❮](color_purple)"
vimcmd_visual_symbol = "[❮](color_yellow)"

# OS module
[os]
format = "[ $symbol]($style)"
style = "bg:color_red fg:color_fg0"
disabled = false

[os.symbols]
Alpine = ""
Amazon = ""
Android = ""
Arch = ""
Artix = ""
CentOS = ""
Debian = ""
Fedora = ""
FreeBSD = ""
Gentoo = ""
Linux = ""
Macos = ""
Manjaro = ""
Mint = ""
NixOS = ""
OpenBSD = ""
openSUSE = ""
Pop = ""
Raspbian = ""
Redhat = ""
RedHatEnterprise = ""
Solus = ""
SUSE = ""
Ubuntu = ""
Unknown = ""
Windows = ""
[shell]
bash_indicator = "bash"
fish_indicator = "fish"
zsh_indicator = "zsh"
powershell_indicator = "pwsh"
ion_indicator = "ion"
elvish_indicator = "esh"
tcsh_indicator = "tsh"
nu_indicator = "nu"
cmd_indicator = "cmd"
unknown_indicator = "mystery shell"
format = "[$indicator]($style)"
style = "bg:color_red fg:color_fg0"
disabled = false

# Directory module
[directory]
style = "bg:color_orange fg:color_fg0"
format = "[ $path]($style)[$read_only]($read_only_style)"
read_only = " 󰌾"
read_only_style = "bg:color_orange fg:color_red"
truncation_length = 3
truncation_symbol = ".../"
truncate_to_repo = true
home_symbol = "󰋜"

# Git branch module
[git_branch]
format = "[ $symbol$branch]($style)"
symbol = " "
style = "bg:color_yellow fg:color_bg1"
truncation_length = 20
truncation_symbol = "..."

# Git status module
[git_status]
format = "([\\[$all_status$ahead_behind$up_to_date\\]]($style))"
style = "bg:color_yellow fg:color_bg1"
conflicted = "!"
ahead = "↑"
behind = "↓"
diverged = "⚡"
untracked = "◌"
stashed = "⚑"
modified = "•"
staged = "+"
renamed = "→"
deleted = "×"

# Package version
[package]
format = "[ $symbol$version]($style)"
symbol = "󰏗 "
style = "bg:color_green fg:color_bg1"

# Programming languages
[nodejs]
format = "[ $symbol($version)]($style)"
symbol = " "
style = "bg:color_green fg:color_bg1"

[python]
format = "[ ${symbol}${pyenv_prefix}(${version})(\\($virtualenv\\))]($style)"
symbol = " "
style = "bg:color_green fg:color_bg1"
pyenv_version_name = false
pyenv_prefix = "pyenv "
python_binary = ["python3", "python", "python2"]
detect_extensions = ["py"]
detect_files = ["requirements.txt", ".python-version", "pyproject.toml", "Pipfile", "setup.py", "tox.ini"]
detect_folders = []

[golang]
format = "[ $symbol($version)]($style)"
symbol = " "
style = "bg:color_green fg:color_bg1"
detect_extensions = ["go"]
detect_files = ["go.mod", "go.sum", "go.work", "go.work.sum"]
detect_folders = ["go"]

[rust]
format = "[ $symbol($version)]($style)"
symbol = "󱘗 "
style = "bg:color_green fg:color_bg1"
detect_extensions = ["rs"]
detect_files = ["Cargo.toml", "Cargo.lock"]
detect_folders = []

[java]
format = "[ ${symbol}(${version})]($style)"
symbol = " "
style = "bg:color_green fg:color_bg1"
detect_extensions = ["java", "class", "jar", "war", "ear"]
detect_files = ["pom.xml", "build.gradle.kts", "build.sbt", ".java-version"]
detect_folders = ["src", "target", "pom.xml"]

# Container and build tools
[docker_context]
format = "[ $symbol$context]($style)"
symbol = "󰡨 "
style = "bg:color_aqua fg:color_bg1"
detect_extensions = []
detect_files = ["docker-compose.yml", "docker-compose.yaml", "Dockerfile", "docker-compose.dev.yml", "docker-compose.ci.yml"]
detect_folders = []

[terraform]
format = "[ $symbol$workspace]($style)"
symbol = "󰔱 "
style = "bg:color_aqua fg:color_bg1"
detect_extensions = ["tf", "tfplan", "tfstate"]
detect_files = [".terraformrc", ".terraform.lock.hcl"]
detect_folders = [".terraform"]

[kubernetes]
format = '[ $symbol$context( \($namespace\))]($style)'
symbol = "󱃾 "
style = "bg:color_aqua fg:color_bg1"
disabled = false
detect_files = ["k8s", "kubernetes", "kubeconfig", "k3s", "kubeadm"]
detect_folders = []
detect_extensions = ["yaml", "yml"]

# Background jobs
[jobs]
format = "[ $symbol$number]($style)"
symbol = "󰜎 "
style = "bg:color_purple fg:color_fg0"
threshold = 1

# Exit status
[status]
format = "[ $symbol$status]($style)"
symbol = "✗ "
style = "bg:color_bg1 fg:color_red"
disabled = false

# Command duration (right prompt)
[cmd_duration]
format = "[󱎫 $duration]($style) "
style = "color_yellow"
min_time = 2000
show_milliseconds = false

# Time module (right prompt)
[time]
format = "[$time]($style)"
style = "color_bg3"
use_12hr = false
disabled = false


# ===================================
# Configuration Notes
# ===================================
# This configuration is automatically generated from modular components:
# - formats/gruvbox-rainbow-light-format.toml: Format and basic settings
# - modules/*: Shared module configurations
# - modes/gruvbox-rainbow-light-overrides.toml: Mode-specific customizations
#
# To modify this configuration, edit the source files and run:
# $ ./build-configs.sh
